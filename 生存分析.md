### 生存函数与风险函数

- 生存函数 (Survival Function)
  $$
  S(t) = P(T > t)
  $$

  表示在时间 $t$ 之后事件还没有发生的概率。
- 风险函数 (Hazard Function)

$$
h(t) = \lim_{\Delta t \to 0} \frac{P(t < T \leq t + \Delta t \mid T \geq t)}{\Delta t}
$$
表示在存活到时间 $t$ 的前提下，瞬时发生事件的速率。

### 生存函数和风险函数的关系

1. 定义（连续时间）
设随机变量 $T$ 表示“事件发生的时间”（比如死亡或复发）。
- 累积分布函数（CDF）表示时间 $t$ 之内事件发生的概率：
$$
F(t) = P(T \leq t)
$$
- 生存函数（Survival function）：
$$
S(t) = P(T > t) = 1 - F(t)
$$
- 若 $T$ 有密度，则概率密度函数（pdf）：
$$
f(t) = \frac{d}{dt} F(t) = -\frac{d}{dt} S(t).
$$
2. 危险率（瞬时风险）的定义（极限形式）
危险率（hazard function）定义为在时间 $t$ 条件下瞬时发生事件的速率（概率）：
$$
h(t) = \frac{F(t+\Delta t|T\geq t)-F(t|T\geq t)}{\Delta t}=\lim_{\Delta t \to 0} \frac{P(t < T \leq t + \Delta t \mid T \geq t)}{\Delta t}
$$
它们之间通过累积风险函数 $H(t)$ 联系起来:
$$
H(t) = \int_{0}^{t} h(u) \, du
$$
生存函数和风险函数的关系是:
$$
S(t) = \exp(-H(t)) = \exp\left(-\int_{0}^{t} h(u) \, du\right)
$$
**证明过程：**

把条件概率展开：
$$
P(t < T \leq t + \Delta \mid T \geq t) = \frac{P(t < T \leq t + \Delta)}{P(T \geq t)} = \frac{F(t + \Delta) - F(t)}{S(t)} = \frac{S(t) - S(t + \Delta)}{S(t)}.
$$
两边除以 $\Delta$ 并取极限，
$$
h(t) = \lim_{\Delta \to 0} \frac{S(t) - S(t + \Delta)}{\Delta S(t)} = -\frac{1}{S(t)} \frac{d}{dt} S(t).
$$
因为 $-\frac{d}{dt} S(t) = f(t)$，所以得到常用形式：
$$
h(t)=\frac{f(t)}{S(t)}
$$


由上式 $f(t) = h(t)S(t)$, 又有 $f(t) = -S'(t)$, 代入得到:
$$
-S'(t) = h(t)S(t).
$$
整理成分离变量形式:
$$
\frac{S'(t)}{S(t)} = -h(t).
$$
对两边关于 $t$ 积分（从 0 到 $t$）:
$$
\int_{0}^{t} \frac{S'(u)}{S(u)} du = -\int_{0}^{t} h(u) du.
$$
左边是对数导数的积分，得到:
$$
\ln S(t) - \ln S(0) = -\int_{0}^{t} h(u) du.
$$
通常假设在 $t = 0$ 时还未发生事件（事件不在 $t<0$ 发生）, $S(0) = 1$, 所以 $\ln S(0) = 0$。于是定义累积危险函数
$$
H(t) = \int_{0}^{t} h(u) du,
$$
得
$$
\ln S(t) = -H(t) \quad \Rightarrow \quad S(t) = \exp \left( -H(t) \right).
$$
这是生存函数与（累积）危险函数之间最重要的关系。

也由此可逆向写出风险率：
$$
h(t)=-\frac{d}{dt}\ln S(t).
$$
同时 pdf 也可以写成：
$$
f(t)=h(t)S(t)=h(t)\exp (-H(t)).
$$


换句话说:
- 风险函数 $h(t)$ 决定了随时间的“瞬时死亡率”。
- 生存函数 $S(t)$ 则是累积风险的指数衰减结果。

### 例子1：恒定风险 (指数分布)
如果风险函数是常数：
$$
h(t)=\lambda
$$
那么累计风险函数：
$$
H(t)=\lambda t
$$
生存函数：
$$
S(t)=e^{-\lambda t}
$$

$$
p=0.2\\
e^{-\lambda}=1-p,=> \lambda =-\ln(1-p)=0.223
$$



### 例子2：Weibull（时间依赖的风险率）

参数化形式（尺度 $\beta>0$，形状 $\alpha > 0$）：
$$
F(t)=1-\exp\left(-(t/\beta)^{\alpha}\right)\quad(t\geq0).
$$
则：
$$
S(t)=\exp\left(-(t/\beta)^{\alpha}\right)
$$
pdf：
$$
f(t)=\frac{\alpha}{\beta}\left(\frac{t}{\beta}\right)^{\alpha-1}\exp\left(-(t/\beta)^{\alpha}\right)
$$
风险率：
$$
h(t)=\frac{f(t)}{S(t)}=\frac{\alpha}{\beta}\left(\frac{t}{\beta}\right)^{\alpha-1}=\frac{\mu +1}{\beta}\left(\frac{t}{\beta}\right)^{\mu}.
$$
可见 Weibull 的危险率随时间成幂律变化（$\alpha>1$ 风险率随时间上升，$\alpha<1$ 下降）

### 直观理解

- 危险率 $h(t)$ 是"在已生存到时间$t$条件下，在接下来的无穷小时间内事件发生的瞬时速率”——它不是
  直接的事件发生概率(那是$f(t)$)，而是条件速率。
- 累积危险 $H(t)$ 把瞬时速率从 0 加到 $t$，而生存 $S(t)=e^{-H(t)}$ 表示"随着总风险累积，存活概率按指数
  衰减”。